<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MechaSearch</title>
    <style>
        :root {
            --dark-red: #c41e3a;
            --dark-blue: #1e3ac4;
            --light-red: rgba(196, 30, 58, 0.1);
            --light-blue: rgba(30, 58, 196, 0.1);
            --background: #111111;
            --surface: #1c1c1c;
            --surface-hover: #252525;
            --text: #ffffff;
            --text-secondary: #b0b0b0;
            --border: #333333;
            --gradient: linear-gradient(135deg, var(--dark-red), var(--dark-blue));
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            background-color: var(--background);
            color: var(--text);
            min-height: 100vh;
        }

        header {
            background: var(--gradient);
            padding: 2.5rem;
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(0,0,0,0.2) 25%, transparent 25%),
                        linear-gradient(-45deg, rgba(0,0,0,0.2) 25%, transparent 25%);
            background-size: 60px 60px;
            opacity: 0.1;
            animation: backgroundShift 30s linear infinite;
        }

        @keyframes backgroundShift {
            0% { background-position: 0 0; }
            100% { background-position: 60px 60px; }
        }

        .team-search {
            margin-top: 1.5rem;
            position: relative;
            display: flex;
            gap: 1rem;
            justify-content: center;
            align-items: center;
        }

        input[type="text"],
        button,
        select {
            padding: 1rem 1.5rem;
            font-size: 1rem;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            background: rgba(255,255,255,0.05);
            color: var(--text);
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        button:focus,
        input[type="text"]:focus,
        select:focus {
            outline: none;
            border-color: rgba(255,255,255,0.2);
            box-shadow: 0 0 20px rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }

        button {
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300%;
            height: 300%;
            background: var(--gradient);
            transition: transform 0.5s ease;
            transform: translate(-50%, -50%) rotate(45deg) translateY(100%);
            z-index: -1;
        }

        button:hover::before {
            transform: translate(-50%, -50%) rotate(45deg) translateY(0);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        section {
            background-color: var(--surface);
            padding: 2.5rem;
            border-radius: 16px;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            border: 1px solid var(--border);
            transition: transform 0.3s ease;
        }

        section:hover {
            transform: translateY(-5px);
        }

        .match-card {
            padding: 8px 12px;
            margin: 4px 0;
            border-radius: 8px;
            background: var(--surface);
        }

        .match-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .scores {
            display: flex;
            gap: 8px;
            font-weight: bold;
        }

        .scores .red { color: var(--dark-red); }
        .scores .blue { color: var(--dark-blue); }

        .points {
            display: flex;
            gap: 12px;
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .event-header {
            padding: 10px 15px;
            margin-bottom: 8px;
        }

        .event-stats p {
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .match-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .alliance-info {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .alliance {
            padding: 0.3em 0.8em;
            border-radius: 8px;
            font-weight: 500;
        }

        .alliance.red { background: rgba(196, 30, 58, 0.2); }
        .alliance.blue { background: rgba(30, 58, 196, 0.2); }

        .score-display {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 1.2em;
            font-weight: 600;
            margin: 1rem 0;
        }

        .score-divider {
            color: var(--text-secondary);
        }

        .red-score.highlighted { color: var(--dark-red); }
        .blue-score.highlighted { color: var(--dark-blue); }

        .status {
            display: inline-block;
            padding: 0.3em 0.8em;
            border-radius: 8px;
            font-size: 0.8em;
            margin-right: 0.5rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            width: 100%;
            transform: none !important;
        }

        .stats-section {
            width: 100%;
            overflow: visible;
        }

        .stats-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 1rem;
            position: relative;
        }

        .stats-table th,
        .stats-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .stats-table th {
            background: rgba(255,255,255,0.05);
            font-weight: 600;
            color: var(--text);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .stats-table td {
            color: var(--text);
            transition: background-color 0.2s ease;
        }

        .stats-table tr:hover td {
            background: var(--surface-hover);
        }

        .stats-table tr:last-child td {
            border-bottom: none;
        }

        .status-indicator {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 500;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .surrogate {
            background: linear-gradient(135deg, #ffd700, #ffa500);
            color: #000;
        }

        .no-show {
            background: linear-gradient(135deg, var(--dark-red), #ff4444);
            color: #fff;
        }

        .dq {
            background: linear-gradient(135deg, #000, #333);
            color: #fff;
        }

        .match-result {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 500;
            text-align: center;
            transition: all 0.3s ease;
        }

        .match-result.won {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }

        .match-result.lost {
            background: linear-gradient(135deg, var(--dark-red), #ff4444);
        }

        .match-result.tie {
            background: linear-gradient(135deg, #FFC107, #FFB300);
        }

        html {
            scroll-behavior: smooth;
        }

        main {
            max-width: 1400px;
            margin: 3rem auto;
            padding: 0 2rem;
            padding-bottom: 6rem;
        }

        footer {
            background: var(--gradient);
            color: white;
            text-align: center;
            padding: 1.5rem;
            position: fixed;
            bottom: 0;
            width: 100%;
            backdrop-filter: blur(10px);
            box-shadow: 0 -4px 20px rgba(0,0,0,0.2);
        }

        @keyframes shimmer {
            from { background-position: -1000px 0; }
            to { background-position: 1000px 0; }
        }

        .loading {
            background: linear-gradient(90deg, var(--surface) 25%, var(--surface-hover) 50%, var(--surface) 75%);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite linear;
        }

        @media (max-width: 768px) {
            .stats-grid,
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .landing-search,
            .team-search {
                flex-direction: column;
            }
            
            .landing-search input[type="text"],
            .landing-search button,
            input[type="text"],
            button,
            select {
                width: 100%;
            }
            
            .landing-title {
                font-size: 2.5rem;
            }
            
            .landing-subtitle {
                font-size: 1rem;
            }
            
            .chart-container {
                min-height: 300px;
            }
        }

        .animate-fade-in {
            will-change: transform, opacity;
            animation: fadeInUp 0.6s ease forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .event-section {
            background-color: var(--surface);
            padding: 2rem;
            border-radius: 16px;
            margin: 2rem;
            border: 1px solid var(--border);
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }

        .event-header {
            margin-bottom: 1.5rem;
        }

        .event-header h2 {
            color: var(--text);
            margin-bottom: 1rem;
        }

        .event-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
        }

        .event-stats p {
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .matches-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .match-card {
            background: var(--surface);
            border-radius: 12px;
            padding: 1.5rem;
            transition: transform 0.3s ease;
            border: 1px solid var(--border);
        }

        .match-card:hover {
            transform: translateY(-5px);
        }

        .match-card[class*="-alliance"] {
            border-left: 4px solid;
        }

        .match-card.red-alliance { border-left-color: var(--dark-red); }
        .match-card.blue-alliance { border-left-color: var(--dark-blue); }

        .match-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .station {
            font-size: 0.9em;
            padding: 0.5em 1em;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
        }

        .match-scores {
            display: flex;
            justify-content: space-between;
            margin: 1rem 0;
        }

        .score {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .score .label {
            color: var(--text-secondary);
        }

        .score .value {
            font-size: 1.2em;
            font-weight: 600;
        }

        .red-score .value {
            color: var(--dark-red);
        }

        .blue-score .value {
            color: var(--dark-blue);
        }

        .match-details {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .landing-header {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            background: transparent;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        .landing-header.searched {
            position: static;
            height: auto;
            transform: none;
            padding: 2rem;
            opacity: 0;
            animation: fadeIn 0.3s ease forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .landing-title {
            font-size: 4rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
            text-align: center;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 4px 12px rgba(0,0,0,0.2);
            animation: titleFloat 3s ease-in-out infinite;
        }

        .landing-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            text-align: center;
            max-width: 600px;
            animation: fadeIn 1s ease-out 0.5s both;
        }

        @keyframes titleFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .landing-search {
            display: flex;
            gap: 1rem;
            justify-content: center;
            align-items: center;
            width: 100%;
            max-width: 700px;
            margin: 0 auto;
        }

        .landing-search input[type="text"] {
            width: 70%;
            padding: 1.2rem 1.5rem;
            font-size: 1.1rem;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            color: var(--text);
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .landing-search input[type="text"]:focus {
            outline: none;
            border-color: rgba(255,255,255,0.2);
            box-shadow: 0 0 20px rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }

        .landing-search button {
            width: 30%;
            padding: 1.2rem 1.5rem;
            font-size: 1.1rem;
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .landing-search button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300%;
            height: 300%;
            background: var(--gradient);
            transition: transform 0.5s ease;
            transform: translate(-50%, -50%) rotate(45deg) translateY(100%);
            z-index: -1;
        }

        .landing-search button:hover::before {
            transform: translate(-50%, -50%) rotate(45deg) translateY(0);
        }

        .landing-search button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        @media (max-width: 768px) {
            .landing-title {
                font-size: 2.5rem;
            }

            .landing-subtitle {
                font-size: 1rem;
            }

            .landing-search {
                flex-direction: column;
                padding: 0 1rem;
            }

            .landing-search input[type="text"],
            .landing-search button {
                width: 100%;
            }

            select {
                width: 100%;
            }
        }

        .main-content {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .main-content.visible {
            display: block;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .chart-container {
            background: var(--surface);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                min-height: 300px;
            }
        }

        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .team-basic-info {
            flex: 1;
        }

        .team-record {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            margin-left: 2rem;
        }

        .record-label {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .record-numbers {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--text);
        }

        select {
            padding: 1rem 1.5rem;
            font-size: 1rem;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            background: rgba(255,255,255,0.05);
            color: var(--text);
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        select:focus {
            outline: none;
            border-color: rgba(255,255,255,0.2);
            box-shadow: 0 0 20px rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }

        .season-selector-container {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
        }

        select#seasonSelector {
            background: var(--surface);
            color: var(--text);
            border: 1px solid var(--border);
            padding: 0.5rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 120px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        select#seasonSelector:hover {
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        select#seasonSelector:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.3);
        }

        #teamInfo {
            padding-top: 1.5rem;
        }

        .team-details {
            margin-top: 1rem;
        }

        .event-section, .match-card, .chart-container {
            background-color: var(--surface);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .event-section:hover, .match-card:hover {
            transform: translateY(-5px);
        }

        .match-card[class*="-alliance"] {
            border-left: 4px solid;
        }

        .match-card.red-alliance { border-left-color: var(--dark-red); }
        .match-card.blue-alliance { border-left-color: var(--dark-blue); }

        .match-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .station {
            font-size: 0.9em;
            padding: 0.5em 1em;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
        }

        .match-scores {
            display: flex;
            justify-content: space-between;
            margin: 1rem 0;
        }

        .score {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .score .label {
            color: var(--text-secondary);
        }

        .score .value {
            font-size: 1.2em;
            font-weight: 600;
        }

        .red-score .value {
            color: var(--dark-red);
        }

        .blue-score .value {
            color: var(--dark-blue);
        }

        .match-details {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .landing-header {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            background: transparent;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        .landing-header.searched {
            position: static;
            height: auto;
            transform: none;
            padding: 2rem;
            opacity: 0;
            animation: fadeIn 0.3s ease forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .landing-title {
            font-size: 4rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
            text-align: center;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 4px 12px rgba(0,0,0,0.2);
            animation: titleFloat 3s ease-in-out infinite;
        }

        .landing-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            text-align: center;
            max-width: 600px;
            animation: fadeIn 1s ease-out 0.5s both;
        }

        @keyframes titleFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .landing-search {
            display: flex;
            gap: 1rem;
            justify-content: center;
            align-items: center;
            width: 100%;
            max-width: 700px;
            margin: 0 auto;
        }

        .landing-search input[type="text"] {
            width: 70%;
            padding: 1.2rem 1.5rem;
            font-size: 1.1rem;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            color: var(--text);
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .landing-search input[type="text"]:focus {
            outline: none;
            border-color: rgba(255,255,255,0.2);
            box-shadow: 0 0 20px rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }

        .landing-search button {
            width: 30%;
            padding: 1.2rem 1.5rem;
            font-size: 1.1rem;
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .landing-search button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300%;
            height: 300%;
            background: var(--gradient);
            transition: transform 0.5s ease;
            transform: translate(-50%, -50%) rotate(45deg) translateY(100%);
            z-index: -1;
        }

        .landing-search button:hover::before {
            transform: translate(-50%, -50%) rotate(45deg) translateY(0);
        }

        .landing-search button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        @media (max-width: 768px) {
            .landing-title {
                font-size: 2.5rem;
            }

            .landing-subtitle {
                font-size: 1rem;
            }

            .landing-search {
                flex-direction: column;
                padding: 0 1rem;
            }

            .landing-search input[type="text"],
            .landing-search button {
                width: 100%;
            }

            select {
                width: 100%;
            }
        }

        .main-content {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .main-content.visible {
            display: block;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .chart-container {
            background: var(--surface);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                min-height: 300px;
            }
        }

        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .team-basic-info {
            flex: 1;
        }

        .team-record {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            margin-left: 2rem;
        }

        .record-label {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .record-numbers {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--text);
        }

        select {
            padding: 1rem 1.5rem;
            font-size: 1rem;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            background: rgba(255,255,255,0.05);
            color: var(--text);
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        select:focus {
            outline: none;
            border-color: rgba(255,255,255,0.2);
            box-shadow: 0 0 20px rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }

        .season-selector-container {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
        }

        select#seasonSelector {
            background: var(--surface);
            color: var(--text);
            border: 1px solid var(--border);
            padding: 0.5rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 120px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        select#seasonSelector:hover {
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        select#seasonSelector:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.3);
        }

        #teamInfo {
            padding-top: 1.5rem;
        }

        .team-details {
            margin-top: 1rem;
        }

        .event-section, .match-card, .chart-container {
            background-color: var(--surface);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .event-section:hover, .match-card:hover {
            transform: translateY(-5px);
        }

        .match-card[class*="-alliance"] {
            border-left: 4px solid;
        }

        .match-card.red-alliance { border-left-color: var(--dark-red); }
        .match-card.blue-alliance { border-left-color: var(--dark-blue); }

        .match-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .station {
            font-size: 0.9em;
            padding: 0.5em 1em;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
        }

        .match-scores {
            display: flex;
            justify-content: space-between;
            margin: 1rem 0;
        }

        .score {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .score .label {
            color: var(--text-secondary);
        }

        .score .value {
            font-size: 1.2em;
            font-weight: 600;
        }

        .red-score .value {
            color: var(--dark-red);
        }

        .blue-score .value {
            color: var(--dark-blue);
        }

        .match-details {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .landing-header {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            background: transparent;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        .landing-header.searched {
            position: static;
            height: auto;
            transform: none;
            padding: 2rem;
            opacity: 0;
            animation: fadeIn 0.3s ease forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .landing-title {
            font-size: 4rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
            text-align: center;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 4px 12px rgba(0,0,0,0.2);
            animation: titleFloat 3s ease-in-out infinite;
        }

        .landing-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            text-align: center;
            max-width: 600px;
            animation: fadeIn 1s ease-out 0.5s both;
        }

        @keyframes titleFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .landing-search {
            display: flex;
            gap: 1rem;
            justify-content: center;
            align-items: center;
            width: 100%;
            max-width: 700px;
            margin: 0 auto;
        }

        .landing-search input[type="text"] {
            width: 70%;
            padding: 1.2rem 1.5rem;
            font-size: 1.1rem;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            color: var(--text);
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .landing-search input[type="text"]:focus {
            outline: none;
            border-color: rgba(255,255,255,0.2);
            box-shadow: 0 0 20px rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }

        .landing-search button {
            width: 30%;
            padding: 1.2rem 1.5rem;
            font-size: 1.1rem;
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .landing-search button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300%;
            height: 300%;
            background: var(--gradient);
            transition: transform 0.5s ease;
            transform: translate(-50%, -50%) rotate(45deg) translateY(100%);
            z-index: -1;
        }

        .landing-search button:hover::before {
            transform: translate(-50%, -50%) rotate(45deg) translateY(0);
        }

        .landing-search button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        @media (max-width: 768px) {
            .landing-title {
                font-size: 2.5rem;
            }

            .landing-subtitle {
                font-size: 1rem;
            }

            .landing-search {
                flex-direction: column;
                padding: 0 1rem;
            }

            .landing-search input[type="text"],
            .landing-search button {
                width: 100%;
            }

            select {
                width: 100%;
            }
        }

        .main-content {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .main-content.visible {
            display: block;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .chart-container {
            background: var(--surface);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                min-height: 300px;
            }
        }

        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .team-basic-info {
            flex: 1;
        }

        .team-record {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            margin-left: 2rem;
        }

        .record-label {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .record-numbers {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--text);
        }

        select {
            padding: 1rem 1.5rem;
            font-size: 1rem;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            background: rgba(255,255,255,0.05);
            color: var(--text);
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        select:focus {
            outline: none;
            border-color: rgba(255,255,255,0.2);
            box-shadow: 0 0 20px rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }

        .season-selector-container {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
        }

        select#seasonSelector {
            background: var(--surface);
            color: var(--text);
            border: 1px solid var(--border);
            padding: 0.5rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 120px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        select#seasonSelector:hover {
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        select#seasonSelector:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.3);
        }

        #teamInfo {
            padding-top: 1.5rem;
        }

        .team-details {
            margin-top: 1rem;
        }

        .event-section, .match-card, .chart-container {
            background-color: var(--surface);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .event-section:hover, .match-card:hover {
            transform: translateY(-5px);
        }

        .match-card[class*="-alliance"] {
            border-left: 4px solid;
        }

        .match-card.red-alliance { border-left-color: var(--dark-red); }
        .match-card.blue-alliance { border-left-color: var(--dark-blue); }

        .animate-fade-in, .landing-header.searched {
            will-change: transform, opacity;
        }

        @media (max-width: 768px) {
            .stats-grid,
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .landing-search,
            .team-search {
                flex-direction: column;
            }
            
            .landing-search input[type="text"],
            .landing-search button,
            input[type="text"],
            button,
            select {
                width: 100%;
            }
            
            .landing-title {
                font-size: 2.5rem;
            }
            
            .landing-subtitle {
                font-size: 1rem;
            }
            
            .chart-container {
                min-height: 300px;
            }
        }

        @keyframes fadeInUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in,
        .stats-grid {
            animation: fadeInUp 0.6s ease forwards;
        }

        .animate-fade-in,
        .stats-grid,
        .match-card,
        button,
        input[type="text"],
        select,
        section {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes shimmer {
            from { background-position: -1000px 0; }
            to { background-position: 1000px 0; }
        }

        .event-section, 
        .match-card, 
        .chart-container {
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }

        @media (max-width: 768px) {
            .stats-grid,
            .charts-grid,
            .landing-search,
            .team-search {
                grid-template-columns: 1fr;
            }
            
            .landing-search input[type="text"],
            .landing-search button,
            input[type="text"],
            button,
            select {
                width: 100%;
            }
            
            .landing-title {
                font-size: 2.5rem;
            }
            
            .landing-subtitle {
                font-size: 1rem;
            }
            
            .chart-container {
                min-height: 300px;
            }
        }

        .match-card,
        .event-section,
        .chart-container {
            will-change: transform;
            transform: translateZ(0);
        }

        .event-section,
        .match-card,
        .chart-container {
            content-visibility: auto;
            contain: content;
            contain-intrinsic-size: 0 500px;
        }

        .animate-fade-in,
        .stats-grid,
        .match-card,
        button,
        input[type="text"],
        select,
        section {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .presentation-zoom {
            animation: searchAreaZoom 1.5s forwards;
        }

        @keyframes searchAreaZoom {
            0% { transform: scale(1); }
            100% { transform: scale(1.1); }
        }

        .feature-highlight {
            animation: featureHighlight 2s infinite;
            box-shadow: 0 0 30px rgba(255,255,255,0.2);
            position: relative;
            z-index: 2;
        }

        .feature-highlight .stats-grid {
            transform: none !important;
            animation: none !important;
        }

        .feature-highlight table {
            transform: none !important;
            animation: none !important;
        }

        @keyframes featureHighlight {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .feature-description {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--dark-red), var(--dark-blue));
            color: white;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 1.2em;
            font-weight: bold;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translate(-50%, 20px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }

        .stats-section {
            transform-style: preserve-3d;
            backface-visibility: hidden;
            perspective: 1000px;
        }

        .stats-table {
            transform: translateZ(0);
            backface-visibility: hidden;
        }

        .feature-highlight .stats-grid,
        .feature-highlight .stats-table,
        .feature-highlight .stats-section {
            transform: none !important;
            animation: none !important;
            backface-visibility: visible !important;
            perspective: none !important;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <meta http-equiv="x-dns-prefetch-control" content="on">
    <link rel="dns-prefetch" href="https://api.ftcscout.org">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://unpkg.com">
    <link rel="preconnect" href="https://api.ftcscout.org">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://unpkg.com">
</head>
<body>
    <canvas id="bg"></canvas>
    <header class="landing-header">
        <h1 class="landing-title">MechaSearch (21781)</h1>
        <p class="landing-subtitle">Explore team statistics, match history, and performance analytics for FIRST Tech Challenge teams.</p>
        <div class="landing-search">
            <input type="text" id="teamNumber" placeholder="Enter Team Number">
            <button onclick="searchTeam()">Search Team</button>
        </div>
    </header>
    <main class="main-content">
        <section id="teamInfo" class="hidden" content-visibility="auto">
            <div class="team-header">
                <div class="team-basic-info">
                    <h2 id="teamName"></h2>
                    <p id="teamLocation"></p>
                </div>
                <div class="season-selector-container hidden">
                    <select id="seasonSelector"></select>
                </div>
                <div class="team-record">
                    <span id="teamRecord"></span>
                </div>
            </div>
            <div class="team-details">
                <div id="teamBasicInfo"></div>
                <div id="teamStats"></div>
            </div>
        </section>

        <section id="stats-container" class="hidden">
            <h2>Event Statistics</h2>
        </section>

        <section id="analytics-container" class="hidden">
            <h2>Performance Analytics</h2>
            <div class="charts-grid">
                <div class="chart-container">
                    <canvas id="scoreProgressionChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="phaseBreakdownChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="performanceRadarChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="consistencyChart"></canvas>
                </div>
            </div>
        </section>
    </main>
    <script defer>
        const API_BASE_URL = 'https://api.ftcscout.org/rest/v1';

        const DOM = {
            mainContent: document.querySelector('.main-content'),
            landingHeader: document.querySelector('.landing-header'),
            teamNumberInput: document.getElementById('teamNumber'),
            seasonSelector: document.getElementById('seasonSelector'),
            statsContainer: document.getElementById('stats-container'),
            analyticsContainer: document.getElementById('analytics-container'),
            teamBasicInfo: document.getElementById('teamBasicInfo'),
            teamStats: document.getElementById('teamStats'),
            charts: {
                scoreProgression: document.getElementById('scoreProgressionChart'),
                phaseBreakdown: document.getElementById('phaseBreakdownChart'),
                performanceRadar: document.getElementById('performanceRadarChart'),
                consistency: document.getElementById('consistencyChart')
            }
        };

        const chartInstances = {
            matchHistory: null,
            phaseBreakdown: null,
            winLoss: null,
            performanceTrends: null
        };

        const apiCache = new Map();
        const getCachedData = async (url, ttl = 300000) => {
            const cached = apiCache.get(url);
            if (cached && Date.now() - cached.timestamp < ttl) {
                return cached.data;
            }
            
            const response = await fetch(url);
            const data = await response.json();
            apiCache.set(url, { data, timestamp: Date.now() });
            return data;
        };

        const chartConfig = {
            responsive: true,
            maintainAspectRatio: false,
            animation: {
                duration: 750,
                easing: 'easeInOutQuart'
            },
            plugins: {
                legend: {
                    labels: { color: '#ffffff' }
                }
            },
            scales: {
                y: {
                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                    ticks: { color: '#ffffff' }
                },
                x: {
                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                    ticks: { color: '#ffffff' }
                }
            }
        };

        const smoothUpdate = (callback) => {
            requestAnimationFrame(() => {
                requestAnimationFrame(callback);
            });
        };

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function destroyCharts() {
            [chartInstances.matchHistory, chartInstances.phaseBreakdown, chartInstances.winLoss, chartInstances.performanceTrends].forEach(chart => {
                if (chart) {
                    chart.destroy();
                    chart = null;
                }
            });
        }

        async function searchTeam() {
            const teamNumber = document.getElementById('teamNumber').value;
            if (!teamNumber) return;

            const mainContent = document.querySelector('.main-content');
            if (mainContent) mainContent.classList.add('visible');

            const landingHeader = document.querySelector('.landing-header');
            if (landingHeader) landingHeader.classList.add('searched');

            try {
                const teamResponse = await fetch(`${API_BASE_URL}/teams/${teamNumber}`);
                const basicTeamData = await teamResponse.json();
                
                createSeasonSelector(basicTeamData.rookieYear || 2024);
                
                const selectorContainer = document.getElementById('seasonSelectorContainer');
                if (selectorContainer) {
                    selectorContainer.classList.remove('hidden');
                    selectorContainer.classList.add('visible');
                }
                
                const selectedYear = document.getElementById('seasonSelector')?.value || 2024;
                const teamData = await fetchTeamData(teamNumber, selectedYear);
                const matchData = await fetchTeamMatches(teamNumber, selectedYear);

                displayTeamInfo(teamData, matchData);
                displayMatchData(matchData);
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function createSeasonSelector(rookieYear) {
            const seasonSelector = document.getElementById('seasonSelector');
            if (!seasonSelector) return;

            const currentYear = 2024;
            seasonSelector.innerHTML = '';
            
            for (let year = currentYear; year >= rookieYear; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                seasonSelector.appendChild(option);
            }
            
            seasonSelector.onchange = async () => {
                const teamNumber = document.getElementById('teamNumber')?.value;
                if (!teamNumber) return;
                
                const selectedYear = seasonSelector.value;
                const teamData = await fetchTeamData(teamNumber, selectedYear);
                const matchData = await fetchTeamMatches(teamNumber, selectedYear);
                
                displayTeamInfo(teamData, matchData);
                displayMatchData(matchData);
            };
        }

        function displayMatchData(matchData) {
            const statsContainer = document.getElementById('stats-container');
            statsContainer.classList.remove('hidden');
            statsContainer.innerHTML = '<h2>Event Statistics</h2>';

            if (!matchData || Object.keys(matchData).length === 0) {
                statsContainer.innerHTML += '<p>No match data available</p>';
                return;
            }

            Object.entries(matchData).forEach(([eventCode, eventData]) => {
                const eventSection = document.createElement('div');
                eventSection.className = 'event-section';
                
                const stats = eventData.details.stats;
                
                const header = document.createElement('div');
                header.className = 'event-header';
                header.innerHTML = `
                    <div class="event-title">
                        <span class="expand-icon"></span>
                        <h2>${eventCode}</h2>
                    </div>
                    <div class="event-stats">
                        <p>R${stats.rank} | ${stats.wins}-${stats.losses}-${stats.ties} | RP:${stats.rp.toFixed(2)} | TB:${stats.tb1.toFixed(1)}/${stats.tb2.toFixed(1)}</p>
                    </div>
                `;
                
                const matchesContainer = document.createElement('div');
                matchesContainer.id = `matches-${eventCode}`;
                matchesContainer.className = 'matches-container hidden';
                matchesContainer.style.display = 'none';
                
                matchesContainer.innerHTML = eventData.matches.map(match => {
                    const redScore = match.redScore?.totalPointsNp || match.redScore?.totalPoints || 0;
                    const blueScore = match.blueScore?.totalPointsNp || match.blueScore?.totalPoints || 0;
                    const autoPoints = match[`${match.alliance.toLowerCase()}Score`]?.autoPoints || 0;
                    const dcPoints = match[`${match.alliance.toLowerCase()}Score`]?.dcPoints || 0;
                    
                    return `
                        <div class="match-card ${match.alliance.toLowerCase()}-alliance">
                            <div class="match-info">
                                <span class="station">${match.alliance} ${match.station}</span>
                                <div class="scores">
                                    <span class="red">${redScore}</span>
                                    <span>-</span>
                                    <span class="blue">${blueScore}</span>
                                </div>
                                <div class="points">
                                    <span>A:${autoPoints}</span>
                                    <span>T:${dcPoints}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                header.addEventListener('click', () => toggleEventMatches(eventCode));
                
                eventSection.appendChild(header);
                eventSection.appendChild(matchesContainer);
                statsContainer.appendChild(eventSection);
            });

            createAnalytics(matchData);
        }

        async function fetchTeamData(teamNumber, year) {
            try {
                console.log('Fetching data for team:', teamNumber);
                
                const teamResponse = await fetch(`${API_BASE_URL}/teams/${teamNumber}`);
                const teamData = await teamResponse.json();
                console.log('Team Data:', teamData);

                const eventsResponse = await fetch(`${API_BASE_URL}/teams/${teamNumber}/events/${year}`);
                const eventsData = await eventsResponse.json();
                console.log('Events Data:', eventsData);
                
                let eventStats = null;
                if (eventsData && eventsData.length > 0) {
                    const sortedEvents = eventsData.sort((a, b) => 
                        new Date(b.startDate) - new Date(a.startDate)
                    );
                    eventStats = sortedEvents[0].stats;
                    console.log('Event Stats:', eventStats);
                }
                
                const statsUrl = `${API_BASE_URL}/teams/${teamNumber}/quick-stats?season=${year}`;
                console.log('Fetching quick stats from:', statsUrl);
                const statsResponse = await fetch(statsUrl);
                const quickStats = await statsResponse.json();
                console.log('Quick Stats:', quickStats);

                const stats = {
                    ...quickStats,
                    ...eventStats,
                    events: eventsData
                };
                console.log('Combined Stats:', stats);
                
                return {
                    ...teamData,
                    stats: stats
                };
            } catch (error) {
                console.error('Error fetching team data:', error);
                throw error;
            }
        }

        async function fetchTeamMatches(teamNumber, year) {
            try {
                const eventsUrl = `${API_BASE_URL}/teams/${teamNumber}/events/${year}`;
                console.log('Fetching events from:', eventsUrl);
                const eventsResponse = await fetch(eventsUrl);
                if (!eventsResponse.ok) throw new Error('Events data not found');
                const eventsData = await eventsResponse.json();
                console.log('Events data:', eventsData);

                const eventMatches = {};
                
                for (const event of eventsData) {
                    try {
                        const eventCode = event.eventCode;
                        
                        const eventMatchesUrl = `${API_BASE_URL}/events/${year}/${eventCode}/matches`;
                        console.log(`Fetching all matches for event ${eventCode} from:`, eventMatchesUrl);
                        const eventMatchesResponse = await fetch(eventMatchesUrl);
                        if (!eventMatchesResponse.ok) continue;
                        const allEventMatches = await eventMatchesResponse.json();
                        console.log(`All matches for event ${eventCode}:`, allEventMatches);

                        const teamMatches = allEventMatches.filter(match => {
                            return match.teams.some(team => team.teamNumber === parseInt(teamNumber));
                        });

                        if (teamMatches.length > 0) {
                            eventMatches[eventCode] = {
                                details: {
                                    name: event.name,
                                    startDate: event.startDate,
                                    endDate: event.endDate,
                                    location: event.location,
                                    stats: event.stats || {
                                        wins: 0,
                                        losses: 0,
                                        ties: 0,
                                        rp: 0,
                                        rank: 0,
                                        tb1: 0,
                                        tb2: 0
                                    }
                                },
                                matches: teamMatches.map(match => {
                                    const ourTeamInfo = match.teams.find(team => 
                                        team.teamNumber === parseInt(teamNumber)
                                    );
                                    
                                    return {
                                        matchNumber: match.id,
                                        matchType: match.tournamentLevel,
                                        alliance: ourTeamInfo.alliance,
                                        station: ourTeamInfo.station,
                                        redScore: match.scores.red,
                                        blueScore: match.scores.blue,
                                        surrogate: ourTeamInfo.surrogate,
                                        noShow: ourTeamInfo.noShow,
                                        dq: ourTeamInfo.dq,
                                        teams: {
                                            red: match.teams.filter(t => t.alliance === 'Red'),
                                            blue: match.teams.filter(t => t.alliance === 'Blue')
                                        }
                                    };
                                })
                            };
                        }
                    } catch (error) {
                        console.error(`Error fetching matches for event ${event.eventCode}:`, error);
                    }
                }

                for (const eventCode in eventMatches) {
                    eventMatches[eventCode].matches.sort((a, b) => {
                        const typeOrder = { 'Quals': 0, 'Semis': 1, 'Finals': 2 };
                        if (a.matchType !== b.matchType) {
                            return typeOrder[a.matchType] - typeOrder[b.matchType];
                        }
                        return a.matchNumber - b.matchNumber;
                    });
                }

                console.log('Final processed event matches:', eventMatches);
                return eventMatches;
            } catch (error) {
                console.error('Error fetching match data:', error);
                return {};
            }
        }

        function determineResult(match) {
            const redScore = match.redScore?.totalPointsNp || match.redScore?.totalPoints || 0;
            const blueScore = match.blueScore?.totalPointsNp || match.blueScore?.totalPoints || 0;
            
            if (match.alliance === 'RED') {
                if (redScore > blueScore) return 'Won';
                if (redScore < blueScore) return 'Lost';
                return 'Tie';
            }
            if (match.alliance === 'BLUE') {
                if (blueScore > redScore) return 'Won';
                if (blueScore < redScore) return 'Lost';
                return 'Tie';
            }
            
            return 'N/A';
        }

        function displayTeamInfo(teamData, matchData) {
            const record = { wins: 0, losses: 0, ties: 0 };
            
            if (matchData) {
                Object.values(matchData).forEach(eventData => {
                    if (eventData.matches) {
                        eventData.matches.forEach(match => {
                            const redScore = match.redScore?.totalPointsNp || match.redScore?.totalPoints || 0;
                            const blueScore = match.blueScore?.totalPointsNp || match.blueScore?.totalPoints || 0;
                            
                            if (match.alliance?.toLowerCase() === 'red') {
                                if (redScore > blueScore) record.wins++;
                                else if (redScore < blueScore) record.losses++;
                                else record.ties++;
                            } else if (match.alliance?.toLowerCase() === 'blue') {
                                if (blueScore > redScore) record.wins++;
                                else if (blueScore < redScore) record.losses++;
                                else record.ties++;
                            }
                        });
                    }
                });
            }

            const basicInfoDiv = document.getElementById('teamBasicInfo');
            basicInfoDiv.innerHTML = `
                <div class="team-header">
                    <div class="team-basic-info">
                        <h3>${teamData.number} - ${teamData.name || 'Unknown Team'}</h3>
                        <p><strong>Location:</strong> ${[
                            teamData.city,
                            teamData.state,
                            teamData.country
                        ].filter(Boolean).join(', ') || 'Location Unknown'}</p>
                        <p><strong>Rookie Year:</strong> ${teamData.rookieYear || 'Unknown'}</p>
                    </div>
                    <div class="team-record">
                        <span class="record-label">Overall Record</span>
                        <span class="record-numbers">${record.wins}W - ${record.losses}L - ${record.ties}T</span>
                    </div>
                </div>
            `;

            const statsDiv = document.getElementById('teamStats');
            
            if (teamData.stats) {
                const formatValue = (value) => {
                    if (typeof value === 'number') return value.toFixed(2);
                    return '0.00';
                };

                const stats = teamData.stats;
                
                statsDiv.innerHTML = `
                    <h3>Team Statistics (2024 Season)</h3>
                    
                    <div class="stats-grid">
                        <div class="stats-section">
                            <h4>Season Rankings</h4>
                            <table class="stats-table">
                                <tr>
                                    <th>Category</th>
                                    <th>Value</th>
                                    <th>Rank</th>
                                </tr>
                                <tr>
                                    <td>Auto</td>
                                    <td>${formatValue(stats.auto?.value)}</td>
                                    <td>${stats.auto?.rank || 'N/A'} of ${stats.count || 'N/A'}</td>
                                </tr>
                                <tr>
                                    <td>Driver Control</td>
                                    <td>${formatValue(stats.dc?.value)}</td>
                                    <td>${stats.dc?.rank || 'N/A'} of ${stats.count || 'N/A'}</td>
                                </tr>
                                <tr>
                                    <td>Endgame</td>
                                    <td>${formatValue(stats.eg?.value)}</td>
                                    <td>${stats.eg?.rank || 'N/A'} of ${stats.count || 'N/A'}</td>
                                </tr>
                            </table>
                        </div>

                        <div class="stats-section">
                            <h4>Average Match Breakdown</h4>
                            <table class="stats-table">
                                <tr>
                                    <th>Phase</th>
                                    <th>Avg</th>
                                    <th>Max</th>
                                </tr>
                                <tr>
                                    <td>Auto</td>
                                    <td>${formatValue(stats.avg?.autoPoints)}</td>
                                    <td>${stats.max?.autoPoints || '0'}</td>
                                </tr>
                                <tr>
                                    <td>Driver Control</td>
                                    <td>${formatValue(stats.avg?.dcPoints)}</td>
                                    <td>${stats.max?.dcPoints || '0'}</td>
                                </tr>
                                <tr>
                                    <td>Total (No Penalties)</td>
                                    <td>${formatValue(stats.avg?.totalPointsNp)}</td>
                                    <td>${stats.max?.totalPointsNp || '0'}</td>
                                </tr>
                                <tr>
                                    <td>Total (With Penalties)</td>
                                    <td>${formatValue(stats.avg?.totalPoints)}</td>
                                    <td>${stats.max?.totalPoints || '0'}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                `;
            } else {
                statsDiv.innerHTML = `
                    <h3>Team Statistics</h3>
                    <p>No statistics available for this team in the current season.</p>
                `;
            }
        }

        function createMatchCard(match) {
            const result = determineResult(match);
            const matchTypeDisplay = match.matchType === 'QUALIFICATION' ? 'Q' : match.matchType === 'SEMIFINAL' ? 'SF' : match.matchType === 'FINAL' ? 'F' : match.matchType;
            
            return `
                <div class="match-card ${match.alliance.toLowerCase()} animate-fade-in">
                    <div class="match-header">
                        <h5>${matchTypeDisplay}-${match.matchNumber}</h5>
                    </div>
                    <div class="match-details">
                        <div class="match-info">
                            <div class="alliance-info">
                                <span class="alliance ${match.alliance.toLowerCase()}">${match.alliance}</span>
                                <span class="station">Station ${match.station}</span>
                            </div>
                            <div class="score-display">
                                <div class="red-score ${match.alliance === 'RED' ? 'highlighted' : ''}">
                                    ${match.redScore !== undefined ? match.redScore : 'TBD'}
                                </div>
                                <div class="score-divider">-</div>
                                <div class="blue-score ${match.alliance === 'BLUE' ? 'highlighted' : ''}">
                                    ${match.blueScore !== undefined ? match.blueScore : 'TBD'}
                                </div>
                            </div>
                            <div class="match-result ${result.toLowerCase()}">
                                ${result}
                            </div>
                        </div>
                        <div class="teams-display">
                            <div class="red-alliance">
                                ${match.teams.red.map(team => 
                                    `<div class="team-number">${team.teamNumber}</div>`
                                ).join('')}
                            </div>
                            <div class="blue-alliance">
                                ${match.teams.blue.map(team => 
                                    `<div class="team-number">${team.teamNumber}</div>`
                                ).join('')}
                            </div>
                        </div>
                        <div class="match-status">
                            ${match.surrogate ? '<span class="status surrogate">Surrogate</span>' : ''}
                            ${match.noShow ? '<span class="status no-show">No Show</span>' : ''}
                            ${match.dq ? '<span class="status dq">Disqualified</span>' : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        function calculateEventStats(matches) {
            return matches.reduce((stats, match) => {
                const result = determineResult(match);
                if (result === 'Won') stats.wins++;
                else if (result === 'Lost') stats.losses++;
                else if (result === 'Tie') stats.ties++;
                return stats;
            }, { wins: 0, losses: 0, ties: 0 });
        }

        function toggleEventMatches(eventCode) {
            const matchesContainer = document.getElementById(`matches-${eventCode}`);
            const expandIcon = matchesContainer.previousElementSibling.querySelector('.expand-icon');
            
            if (matchesContainer.style.display === 'none') {
                matchesContainer.style.display = 'block';
                expandIcon.style.transform = 'rotate(180deg)';
            } else {
                matchesContainer.style.display = 'none';
                expandIcon.style.transform = 'rotate(0deg)';
            }
        }

        function createAnalytics(matchData) {
            document.getElementById('analytics-container').classList.remove('hidden');
            
            const allMatches = Object.values(matchData).flatMap(event => event.matches);
            
            if (chartInstances.matchHistory) chartInstances.matchHistory.destroy();
            if (chartInstances.phaseBreakdown) chartInstances.phaseBreakdown.destroy();
            if (chartInstances.winLoss) chartInstances.winLoss.destroy();
            if (chartInstances.performanceTrends) chartInstances.performanceTrends.destroy();
            
            chartInstances.matchHistory = createMatchHistoryChart(allMatches);
            chartInstances.phaseBreakdown = createScoringBreakdownChart(allMatches);
            chartInstances.winLoss = createWinLossChart(allMatches);
            chartInstances.performanceTrends = createPerformanceTrendsChart(allMatches);
        }

        function createMatchHistoryChart(matches) {
            const ctx = document.getElementById('scoreProgressionChart').getContext('2d');
            
            const matchData = matches.map((match, index) => {
                const alliance = match.alliance.toLowerCase();
                const score = match[`${alliance}Score`];
                return {
                    auto: score?.autoPoints || 0,
                    teleop: score?.dcPoints || 0,
                    total: score?.totalPointsNp || 0,
                    matchNumber: index + 1
                };
            });

            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: matchData.map(m => `Match ${m.matchNumber}`),
                    datasets: [
                        {
                            label: 'Auto',
                            data: matchData.map(m => m.auto),
                            backgroundColor: 'rgba(255, 206, 86, 0.8)',
                            stack: 'Stack 0',
                        },
                        {
                            label: 'TeleOp',
                            data: matchData.map(m => m.teleop),
                            backgroundColor: 'rgba(75, 192, 192, 0.8)',
                            stack: 'Stack 0',
                        },
                        {
                            label: 'Match Average',
                            data: matchData.map(() => {
                                const avg = matchData.reduce((sum, m) => sum + m.total, 0) / matchData.length;
                                return avg;
                            }),
                            type: 'line',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 2,
                            fill: false,
                            pointRadius: 0,
                        }
                    ]
                },
                options: {
                    ...chartConfig,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Match History Breakdown',
                            color: '#ffffff',
                            font: { size: 16 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    const value = context.parsed.y || 0;
                                    return `${label}: ${Math.round(value)} points`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function createScoringBreakdownChart(matches) {
            const ctx = document.getElementById('phaseBreakdownChart').getContext('2d');
            
            const scoringData = matches.reduce((acc, match) => {
                const alliance = match.alliance.toLowerCase();
                const score = match[`${alliance}Score`];
                if (score) {
                    acc.auto += score.autoPoints || 0;
                    acc.teleop += score.dcPoints || 0;
                }
                return acc;
            }, { auto: 0, teleop: 0 });

            const total = scoringData.auto + scoringData.teleop;
            const autoPercentage = (scoringData.auto / total * 100).toFixed(1);
            const teleopPercentage = (scoringData.teleop / total * 100).toFixed(1);

            return new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: [`Auto (${autoPercentage}%)`, `TeleOp (${teleopPercentage}%)`],
                    datasets: [{
                        data: [scoringData.auto, scoringData.teleop],
                        backgroundColor: [
                            'rgba(255, 206, 86, 0.8)',
                            'rgba(75, 192, 192, 0.8)'
                        ],
                        borderColor: 'rgba(255, 255, 255, 0.1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    ...chartConfig,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Scoring Phase Distribution',
                            color: '#ffffff',
                            font: { size: 16 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed || 0;
                                    return `${label}: ${Math.round(value)} points`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function createWinLossChart(matches) {
            const ctx = document.getElementById('performanceRadarChart').getContext('2d');
            
            const results = matches.reduce((acc, match) => {
                const redScore = match.redScore?.totalPointsNp || match.redScore?.totalPoints || 0;
                const blueScore = match.blueScore?.totalPointsNp || match.blueScore?.totalPoints || 0;
                
                if (match.alliance.toLowerCase() === 'red') {
                    if (redScore > blueScore) acc.won++;
                    else if (redScore < blueScore) acc.lost++;
                    else acc.tie++;
                } else if (match.alliance.toLowerCase() === 'blue') {
                    if (blueScore > redScore) acc.won++;
                    else if (blueScore < redScore) acc.lost++;
                    else acc.tie++;
                }
                
                return acc;
            }, { won: 0, lost: 0, tie: 0 });

            console.log('Match Results:', results);

            const total = matches.length;
            const winRate = total > 0 ? ((results.won / total) * 100).toFixed(1) : '0.0';

            return new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [
                        `Wins (${results.won})`,
                        `Losses (${results.lost})`,
                        `Ties (${results.tie})`
                    ],
                    datasets: [{
                        data: [results.won, results.lost, results.tie],
                        backgroundColor: [
                            'rgba(75, 192, 192, 0.8)',
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(255, 206, 86, 0.8)'
                        ],
                        borderColor: 'rgba(255, 255, 255, 0.1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    ...chartConfig,
                    plugins: {
                        title: {
                            display: true,
                            text: `Win/Loss Record (${winRate}% Win Rate)`,
                            color: '#ffffff',
                            font: { size: 16 }
                        }
                    }
                }
            });
        }

        function createPerformanceTrendsChart(matches) {
            const ctx = document.getElementById('consistencyChart').getContext('2d');
            
            const movingAverage = (data, windowSize) => {
                const result = [];
                for (let i = 0; i < data.length; i++) {
                    const start = Math.max(0, i - windowSize + 1);
                    const window = data.slice(start, i + 1);
                    const avg = window.reduce((sum, val) => sum + val, 0) / window.length;
                    result.push(avg);
                }
                return result;
            };

            const scores = matches.map(match => {
                const alliance = match.alliance.toLowerCase();
                return match[`${alliance}Score`]?.totalPointsNp || 0;
            });

            const trendLine = movingAverage(scores, 3);

            return new Chart(ctx, {
                type: 'line',
                data: {
                    labels: matches.map((_, i) => `Match ${i + 1}`),
                    datasets: [
                        {
                            label: 'Match Score',
                            data: scores,
                            borderColor: 'rgba(75, 192, 192, 0.8)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            pointRadius: 4,
                            fill: true
                        },
                        {
                            label: '3-Match Average',
                            data: trendLine,
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false
                        }
                    ]
                },
                options: {
                    ...chartConfig,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Performance Trends',
                            color: '#ffffff',
                            font: { size: 16 }
                        }
                    }
                }
            });
        }

        const PRESENTATION = {
            isActive: false,
            interval: null,
            steps: [
                {
                    action: () => {
                        DOM.mainContent.classList.remove('visible');
                        DOM.landingHeader.classList.remove('searched');
                        DOM.teamNumberInput.value = '';
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                        const searchArea = document.querySelector('.landing-search');
                        searchArea.classList.add('presentation-zoom');
                        setTimeout(() => {
                            simulateTyping('21781', () => {
                                searchArea.classList.remove('presentation-zoom');
                                setTimeout(() => {
                                    searchArea.classList.remove('presentation-zoom');
                                    searchTeam();
                                    setTimeout(showcaseFeatures, 2000);
                                }, 500);
                            });
                        }, 1500);
                    }
                }
            ],
            currentStep: 0
        };

        function simulateTyping(text, callback) {
            let index = 0;
            DOM.teamNumberInput.value = '';
            
            const typeChar = () => {
                if (index < text.length) {
                    DOM.teamNumberInput.value += text.charAt(index);
                    index++;
                    setTimeout(typeChar, 200);
                } else {
                    if (callback) callback();
                }
            };
            
            typeChar();
        }

        function showcaseFeatures() {
            if (!PRESENTATION.isActive) return;

            const features = [
                {
                    element: document.querySelector('#teamInfo'),
                    duration: 4000,
                    highlight: true,
                    description: 'Team Information & Statistics'
                },
                {
                    element: document.querySelector('#stats-container'),
                    duration: 5000,
                    highlight: true,
                    description: 'Event Performance'
                },
                {
                    element: document.querySelector('#analytics-container'),
                    duration: 8000,
                    highlight: true,
                    description: 'Performance Analytics'
                }
            ];

            let currentFeatureIndex = 0;

            function showNextFeature() {
                if (!PRESENTATION.isActive) return;

                document.querySelectorAll('.feature-highlight').forEach(el => {
                    el.classList.remove('feature-highlight');
                });

                const oldDesc = document.getElementById('feature-description');
                if (oldDesc) oldDesc.remove();

                if (currentFeatureIndex >= features.length) {
                    currentFeatureIndex = 0;
                    executeCurrentStep();
                    return;
                }

                const feature = features[currentFeatureIndex];

                feature.element.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });

                if (feature.highlight) {
                    feature.element.classList.add('feature-highlight');
                }

                const description = document.createElement('div');
                description.id = 'feature-description';
                description.innerHTML = feature.description;
                description.className = 'feature-description';
                document.body.appendChild(description);

                setTimeout(() => {
                    currentFeatureIndex++;
                    showNextFeature();
                }, feature.duration);
            }

            showNextFeature();
        }

        function togglePresentationMode() {
            PRESENTATION.isActive = !PRESENTATION.isActive;
            
            if (PRESENTATION.isActive) {
                startPresentation();
                console.log('Presenting on');
                console.log('Use "togglePresentationMode()" to deactivate');
            } else {
                stopPresentation();
                console.log('Presenting off');
            }
        }

        function startPresentation() {
            PRESENTATION.currentStep = 0;
            executeCurrentStep();
        }

        function executeCurrentStep() {
            if (!PRESENTATION.isActive) return;
            
            const step = PRESENTATION.steps[PRESENTATION.currentStep];
            step.action();
        }

        function stopPresentation() {
            clearTimeout(PRESENTATION.interval);
            
            const description = document.getElementById('feature-description');
            if (description) description.remove();
            
            document.querySelectorAll('.feature-highlight').forEach(el => {
                el.classList.remove('feature-highlight');
            });
            
            const searchArea = document.querySelector('.landing-search');
            searchArea.classList.remove('presentation-zoom');
        }

        window.togglePresentationMode = togglePresentationMode;
    </script>
</body>
</html>
